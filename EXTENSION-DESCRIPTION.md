# AppDNA VS Code Extension: How It Works

## Overview
This extension provides a graphical interface in Visual Studio Code for editing, validating, and managing AppDNA model files (JSON) using a dynamic UI generated from an external JSON schema (`app-dna.schema.json`). It is designed for code generation and model-driven development workflows.

## Key Features
- **Dynamic UI Generation:**
  - The extension loads and parses `app-dna.schema.json` to discover all possible properties and their types.
  - All forms, tabs, and controls are generated dynamically based on the schema, not hardcoded.
  - Enum properties are rendered as dropdowns; other types use appropriate controls.

- **Model Editing:**
  - The extension loads the model file (e.g., `app-dna.json`) into memory and allows editing via a sidebar tree and detail webviews.
  - Changes are made in-memory and only written to disk when the user clicks the save button.
  - Each editable property has a checkbox to control its presence in the JSON file. Unchecked means the property is omitted.
  - Real-time validation and tooltips are provided using schema descriptions.

- **File Watching and Save Logic:**
  - A file watcher monitors the model file for external changes. To avoid overwriting in-memory edits, saves triggered by the extension are ignored by the watcher.
  - The save button writes the current in-memory model to disk and logs the action.

- **Commands and Logging:**
  - All user commands (add, save, refresh, etc.) are logged in `copilot-command-history.txt` for traceability.
  - The extension provides commands for adding objects, properties, generating code, and more.

- **UI/UX Conventions:**
  - Controls are styled to match VS Codeâ€™s default look and feel.
  - Tabs are left-justified. Properties are displayed alphabetically.
  - Read-only controls have a distinct background.
  - No delete operations are exposed; instead, properties like `isIgnored` are used to exclude items.

## Architecture
- **Tree View:**
  - The sidebar shows a tree of model objects, loaded from the model file.
  - Selecting an item opens a webview with details and editable fields.

- **Webviews:**
  - Object details and settings are shown in webviews, which communicate with the extension via `vscode.postMessage`.
  - All changes are applied directly to the in-memory model instance.

- **ModelService:**
  - Singleton service that manages loading, saving, and providing access to the in-memory model.
  - Handles file I/O and schema validation.

- **Schema-Driven UI:**
  - The extension never hardcodes property names or types. All UI is generated by iterating over the schema.
  - Enum types are always rendered as dropdowns, and descriptions are shown as tooltips.

## Coding Conventions
- Double quotes are preferred in JavaScript.
- Template literals are avoided for short strings; regular concatenation is used.
- Comments are encouraged for clarity.
- Files are kept small and focused.
- All user commands are logged.

## Real-Time Validation
- User input is validated against the schema as it is entered.
- Errors and warnings are shown in real time.

## How to Extend
- To add new properties or objects, update `app-dna.schema.json` and the extension will automatically reflect the changes in the UI.
- To add new commands, register them in `registerCommands.ts` and log their usage.

## Limitations
- No delete operations are provided; use `isIgnored` or similar flags to exclude items.
- All model changes are in-memory until explicitly saved.

## Troubleshooting
- If changes are not saved, ensure the save button is used and check for file watcher conflicts.
- Use the debug logs in the Extension Host and webview developer tools for troubleshooting.

---
This file is intended for onboarding, maintenance, and future development of the AppDNA VS Code extension.
